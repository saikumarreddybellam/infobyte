<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>User Management</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" th:href="@{/ui/dashboard}">Quiz App</a>
    <div class="navbar-nav ms-auto">
      <span class="navbar-text me-3" th:text="'Welcome, ' + ${#authentication.name}"></span>
      <form th:action="@{/logout}" method="post">
        <button type="submit" class="btn btn-outline-light">Logout</button>
      </form>
    </div>
  </div>
</nav>

<div class="container mt-4">
  <h2>User Management</h2>
  <a th:href="@{/ui/dashboard}" class="btn btn-secondary mb-3">Back to Dashboard</a>

  <div class="card">
    <div class="card-body">
      <table class="table table-striped">
        <thead>
        <tr>
          <th>Username</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="user : ${users}">
          <td th:text="${user.username}"></td>
          <td>
                            <span th:text="${user.role}"
                                  th:class="${user.role == 'ADMIN'} ? 'badge bg-danger' : 'badge bg-primary'"></span>
          </td>
          <td>
            <div class="btn-group">
              <button th:if="${user.role == 'USER'}"
                      class="btn btn-sm btn-warning"
                      onclick="promoteUser([[${user.username}]])">Make Admin</button>
              <button class="btn btn-sm btn-danger"
                      onclick="deleteUser([[${user.username}]])">Delete</button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  function promoteUser(username) {
      if (confirm('Are you sure you want to make this user an admin?')) {
          fetch('/api/admin/users/' + username + '/promote', { method: 'POST' })
              .then(response => location.reload());
      }
  }

  function deleteUser(username) {
      if (confirm('Are you sure you want to delete this user?')) {
          fetch('/api/admin/users/' + username, { method: 'DELETE' })
              .then(response => location.reload());
      }
  }
</script>
</body>
</html>